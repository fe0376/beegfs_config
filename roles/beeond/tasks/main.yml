- command: uname -r
  register: uname

- name: install gcc and kernel-devel
  yum: name={{ item }}
  with_items:
    - kernel-devel-{{ uname.stdout }}
    - gcc

# - name: install beegfs rpm
#   yum: name={{ item }}
#   with_fileglob:
#     - /usr/local/src/beegfs-common*
#     - /usr/local/src/beegfs-opentk-lib*
#     - /usr/local/src/beegfs-client*
#     - /usr/local/src/beegfs-helperd*
#     - /usr/local/src/beegfs-utils*
#     - /usr/local/src/beegfs-mgmtd*
#     - /usr/local/src/beegfs-meta*
#     - /usr/local/src/beegfs-storage*
#     - /usr/local/src/beeond*
- name: install beegfs rpm
  yum: name=beeond
    
- lineinfile: dest=/etc/beegfs/beegfs-client.conf regexp='^connInterfacesFile' line='connInterfacesFile = /etc/beegfs/interface'
- lineinfile: dest=/etc/beegfs/beegfs-mgmtd.conf regexp='^connInterfacesFile' line='connInterfacesFile = /etc/beegfs/interface'
- lineinfile: dest=/etc/beegfs/beegfs-meta.conf regexp='^connInterfacesFile' line='connInterfacesFile = /etc/beegfs/interface'
- lineinfile: dest=/etc/beegfs/beegfs-storage.conf regexp='^connInterfacesFile' line='connInterfacesFile = /etc/beegfs/interface'      
- lineinfile: dest=/etc/beegfs/interface line='{{ item }}' create=yes
  with_items: "{{ network_interface }}"
    
- lineinfile: dest=/etc/beegfs/beegfs-client-autobuild.conf regexp='^buildArgs=' line='buildArgs=-j8 BEEGFS_OPENTK_IBVERBS=1 OFED_INCLUDE_PATH={{ ofed_include_path }}'
  when: use_rdma
  
- command: "/etc/init.d/beegfs-client rebuild"  

   
